
1. Step 1 : Inspect the Info_file that will read in the Billions.csv so we can see how they will merge 


2. Create the Bespoke_Read_Function() 
Which make sure the billionaires CSV has the correct type of data 
```{r}
Bespoke_Read_Function <- function(data_path, info_path) {
  # Load/install packages using pacman
  if (!require(pacman)) install.packages("pacman")
  pacman::p_load(readxl, readr, dplyr)
  
  # Step 1: Read and prepare the info file
  Info_File <- read_excel(info_path) %>%
    select(Key, `Column Type`) %>%  # Use only these two columns 
    rename(column = Key, type = `Column Type`) %>%
    mutate(column = tolower(column))  # Ensure consistent case
  
  # Step 2: Read billionaires data column names
  billionaires_cols <- names(read_csv(data_path, n_max = 0)) %>%
    tolower()  # Match case with Info_File
  
  # Step 3: Create column type specification
  col_spec <- list()
  
  for (col in billionaires_cols) {
    col_info <- Info_File %>% filter(column == col)
    
    if (nrow(col_info) == 1) {
      col_spec[[col]] <- switch(col_info$type,
                               "String" = col_character(),
                               "Integer" = col_integer(),
                               "Float" = col_double(),
                               col_character()) # default
    } else {
      warning(paste("Column", col, "not found in Info_File. Defaulting to character."))
      col_spec[[col]] <- col_character()
    }
  }
  
  # Step 4: Read data 
  billionaires <- read_csv(
    data_path,
    col_types = do.call(cols, col_spec),
    name_repair = "minimal"  # Preserve original column names
  )
  
  return(billionaires)
}

#Call the function 
billionaires <- Bespoke_Read_Function(
  "C:/Users/pmnha/OneDrive/Desktop/Masters 2025_Economics/Datascience/Exam/22660348/Question4/Data/billionaires.csv",
  "C:/Users/pmnha/OneDrive/Desktop/Masters 2025_Economics/Datascience/Exam/22660348/Question4/Data/Info_File.xlsx"
)

# Verify column types
glimpse(billionaires)

```

Goal : Understand of the changing wealth patterns seen globally 
Test 2 claims 
Test Claim 1



Question : In the US , you saw an increasing number of new billionaires emerge that had little to no familial ties to generetional wealth 
We do a temporal trend analysis : Shows the trend of self-made billionaires over time
```{r}
# Dataset name billionaires

library(ggplot2)
billionaires %>%
  filter(location.citizenship == "United States", 
         wealth.how.inherited == "not inherited") %>%
  count(year) %>%
  ggplot(aes(x = year, y = n)) +
  geom_line(color = "#1f77b4", linewidth = 1.5) +
  labs(title = "Rise of Self-Made Billionaires in the US (1996–Present)",
       x = "Year", y = "Number of Billionaires") +
  theme_minimal()


```




Comparison with Inherited Wealth : Compares self-made vs. inherited wealth billionaires.To see if there is actually a true effect 

```{r}
# Create a cleaner version of inheritance types for grouping and plotting
billionaires %>%
  filter(location.citizenship == "United States",
         !is.na(wealth.how.inherited)) %>%
  mutate(inheritance_group = case_when(
    wealth.how.inherited == "not inherited" ~ "Not Inherited",
    wealth.how.inherited == "father" ~ "Father",
    wealth.how.inherited == "spouse/widow" ~ "Spouse/Widow",
    grepl("generation", wealth.how.inherited) ~ "Multi-Generational",
    TRUE ~ "Other"
  )) %>%
  count(year, inheritance_group) %>%
  ggplot(aes(x = year, y = n, fill = inheritance_group)) +
  geom_area(alpha = 0.8) +
  labs(
    title = "US Billionaires by Wealth Inheritance Type",
    x = "Year", y = "Count", fill = "Inheritance Type"
  ) +
  scale_fill_manual(values = c(
    "Not Inherited" = "#ff7f0e",
    "Father" = "#d62728",
    "Spouse/Widow" = "#2ca02c",
    "Multi-Generational" = "#9467bd",
    "Other" = "#8c564b"
  )) +
  theme_minimal()

```



Industry/Sector Breakdown (Secondary Analysis): hows which industries dominate among self-made billionaires.for the US 
What happens if we classify by gender 
```{r}
# Load libraries
library(dplyr)
library(ggplot2)

# Prepare the data
bubble_data_year <- billionaires %>%
  filter(
    location.citizenship == "United States",
    wealth.how.inherited %in% c(
      "not inherited", "father", "spouse/widow",
      "3rd generation", "4th generation", "5th generation or longer"
    ),
    !is.na(wealth.how.industry),
    !is.na(year)
  ) %>%
  count(year, wealth.how.inherited, wealth.how.industry, name = "count") %>%
  mutate(
    highlight = ifelse(wealth.how.inherited == "not inherited", "Not Inherited", "Other"),
    x_label = ifelse(wealth.how.inherited == "not inherited", "Not Inherited", "")
  )

# Plot
ggplot(bubble_data_year, aes(
  x = x_label,
  y = wealth.how.industry,
  size = count,
  color = highlight
)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_color_manual(values = c("Not Inherited" = "#1f77b4", "Other" = "gray80")) +
  scale_size_area(max_size = 15) +
  facet_wrap(~ year, ncol = 3) +
  labs(
    title = "Surge of New-Money In the US: Industry Breakdown Over Time (1990s–2010s)",  #need to italic subtitle
   subtitle = "Forget trust funds – this is how tech wizards,hedge fund sharks, and disruptors built their billions",
  x = "Inheritance Type",
    x = "Inheritance Type",
    y = "Industry",
    size = "Number of Billionaires"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(face = "bold", color = "#1f77b4"),
    strip.text = element_text(face = "bold")
  )

```



subclaim b : Other development markets and emerging markets tend to have less enterpreneurial successes and tend to house mostly inhereted wealth 
We drop the US from developed markets - then compare it to developed markets and emerging markets using a lolipop chart 
The graph is the same if we test wealth in billions 

```{r}

library(dplyr)
library(ggplot2)
library(tidyr)
library(ggthemes)

# Step 1: Reclassify market types with US separate
billionaires <- billionaires %>%
  mutate(
    wealth_origin_grouped = ifelse(wealth.how.inherited == "not inherited", "Not Inherited", "Inherited"),
    market_type_clean = case_when(
      location.citizenship == "United States" ~ "United States",
      market_type == "Developed Market" ~ "Developed Market (excl. US)",
      TRUE ~ market_type
    )
  )

# Step 2: Summarize grouped data
wealth_by_market <- billionaires %>%
  group_by(market_type_clean, wealth_origin_grouped) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(market_type_clean) %>%
  mutate(percentage = count / sum(count) * 100)

# Step 3: Lollipop chart with improved styling
ggplot(wealth_by_market, aes(x = reorder(market_type_clean, percentage), y = percentage, color = wealth_origin_grouped)) +
  geom_segment(aes(xend = market_type_clean, y = 0, yend = percentage),
               color = "gray75", size = 0.7) +  # Fainter lines
  geom_point(size = 6, alpha = 0.95) +         # Darker, clearer bubbles
  coord_flip() +
  labs(
    title = "Entrepreneurial vs Inherited Wealth by Market Type (US Treated Separately)",
    y = "Percentage of Billionaires",
    x = "Market Type",
    color = "Wealth Origin"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    axis.title = element_text(size = 12),
    legend.position = "top"
  )


```






Claim2 : Most self-made millionares are in software , compared to services .This is related to a country's GDP with richer countries providing  more innovation in consumer services 
Try adding percentage to the blue and green sector 
```{r}

library(dplyr)
library(ggplot2)
library(forcats)

# Reclassify market type: separate US as before or keep original if you prefer
billionaires <- billionaires %>%
  mutate(
    market_type_clean = case_when(
      location.citizenship == "United States" ~ "United States",
      TRUE ~ market_type
    ),
    wealth_origin_grouped = ifelse(`wealth.how.inherited` == "not inherited", "Not Inherited", "Inherited"),
    wealth.how.industry_clean = case_when(
      # Clean typos or group related industries
      grepl("Technology", wealth.how.industry, ignore.case = TRUE) ~ "Technology",
      grepl("Consumer", wealth.how.industry, ignore.case = TRUE) ~ "Consumer Services",
      grepl("Retail", wealth.how.industry, ignore.case = TRUE) ~ "Retail/Restaurant",
      grepl("Real Estate", wealth.how.industry, ignore.case = TRUE) ~ "Real Estate",
      grepl("Financial|banking|hedge|venture|private equity|money management", wealth.how.industry, ignore.case = TRUE) ~ "Financial Services",
      grepl("Mining|Energy|Industrial|Construction|Metals", wealth.how.industry, ignore.case = TRUE) ~ "Industrial/Mining/Energy",
      is.na(wealth.how.industry) ~ "Unknown",
      TRUE ~ "Other"
    )
  )

industry_dist <- billionaires %>%
  filter(wealth_origin_grouped == "Not Inherited") %>%  # Focus on self-made
  group_by(market_type_clean, wealth.how.industry_clean) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(market_type_clean) %>%
  mutate(percentage = count / sum(count) * 100)


# Prepare data - same as before
industry_dist <- billionaires %>%
  filter(wealth_origin_grouped == "Not Inherited") %>%
  mutate(
    market_type_clean = case_when(
      location.citizenship == "United States" ~ "United States",
      TRUE ~ market_type
    ),
    wealth.how.industry_clean = case_when(
      grepl("Technology", wealth.how.industry, ignore.case = TRUE) ~ "Technology",
      grepl("Consumer", wealth.how.industry, ignore.case = TRUE) ~ "Consumer Services",
      TRUE ~ "Other"
    )
  ) %>%
  group_by(market_type_clean, wealth.how.industry_clean) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(market_type_clean) %>%
  mutate(percentage = count / sum(count) * 100)

# Define colors: highlight Technology & Consumer Services
fill_colors <- c(
  "Technology" = "#1f78b4",        # blue
  "Consumer Services" = "#33a02c", # green
  "Other" = "grey95"                # light grey
)

# Plot stacked bar chart (diversity chart style)
ggplot(industry_dist, aes(x = market_type_clean, y = percentage, fill = wealth.how.industry_clean)) +
  geom_col(color = "black", size = 0.15) +  # small border to separate segments
  scale_fill_manual(values = fill_colors) +
  coord_flip() +
  labs(
    title = "Industry Diversity of Self-Made Billionaires by Market Type",
    subtitle = "Technology & Consumer Services Highlighted",
    x = "Market Type",
    y = "Percentage of Self-Made Billionaires",
    fill = "Industry"
  ) +
  theme_minimal() +
  theme(legend.position = "top")

```







3. Advanced Analyses for Robust Validation
A. Wealth Mobility Analysis

GDP Correlation Analysis 

4. Key Visualizations for Executive Presentation

1. Geospatial Heatmap (Billionaire Density by Country)
Purpose: Visualize concentration ofBillions by country/region over decades.
Why? Tests the claim about "entrepreneurial success in US vs. other markets."
R Code:
